{
  "Administrator account": {
    "severity": "HIGH",
    "description": "Le compte Administrator intégré est activé, ce qui représente une cible privilégiée pour les attaquants.",
    "remediation": "Désactiver le compte Administrator intégré et utiliser des comptes nommés avec des privilèges appropriés.",
    "commands": [
      "Disable-LocalUser -Name 'Administrator'"
    ],
    "references": [
      "CIS Microsoft Windows Server Benchmark v3.0.0 - Section 2.3.1.1"
    ]
  },
  "Guest account": {
    "severity": "HIGH",
    "description": "Le compte Guest permet un accès non authentifié au système.",
    "remediation": "S'assurer que le compte Guest est désactivé (recommandé).",
    "commands": [
      "Disable-LocalUser -Name 'Guest'"
    ],
    "references": [
      "CIS Microsoft Windows Server Benchmark v3.0.0 - Section 2.3.1.2"
    ]
  },
  "Password minimum length": {
    "severity": "HIGH",
    "description": "Les mots de passe courts sont vulnérables aux attaques par force brute.",
    "remediation": "Configurer une longueur minimale de mot de passe d'au moins 12 caractères.",
    "commands": [
      "net accounts /minpwlen:12"
    ],
    "references": [
      "CIS Microsoft Windows Server Benchmark v3.0.0 - Section 1.1.1",
      "ANSSI - Recommandations de sécurité relatives aux mots de passe"
    ]
  },
  "LAPS installation": {
    "severity": "HIGH",
    "description": "LAPS (Local Administrator Password Solution) n'est pas installé. Sans LAPS, les mots de passe des administrateurs locaux peuvent être identiques sur plusieurs machines.",
    "remediation": "Installer et configurer Microsoft LAPS pour gérer automatiquement les mots de passe des comptes administrateurs locaux.",
    "commands": [
      "# Télécharger LAPS depuis Microsoft",
      "# Installer le MSI LAPS",
      "# Étendre le schéma Active Directory",
      "Update-AdmPwdADSchema",
      "# Configurer la GPO pour activer LAPS"
    ],
    "references": [
      "Microsoft LAPS Documentation",
      "CIS Microsoft Windows Server Benchmark v3.0.0 - Section 18.2"
    ]
  },
  "UAC (EnableLUA)": {
    "severity": "HIGH",
    "description": "Le contrôle de compte d'utilisateur (UAC) protège contre les élévations de privilèges non autorisées.",
    "remediation": "S'assurer que UAC est activé sur tous les systèmes.",
    "commands": [
      "Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System' -Name 'EnableLUA' -Value 1"
    ],
    "references": [
      "CIS Microsoft Windows Server Benchmark v3.0.0 - Section 2.3.17.1"
    ]
  },
  "SMBv1": {
    "severity": "CRITICAL",
    "description": "SMBv1 est obsolète et vulnérable à de nombreuses attaques (WannaCry, NotPetya, etc.).",
    "remediation": "Désactiver complètement SMBv1 et migrer vers SMBv2/SMBv3.",
    "commands": [
      "Disable-WindowsOptionalFeature -Online -FeatureName SMB1Protocol -NoRestart"
    ],
    "references": [
      "Microsoft Security Advisory - Stop using SMB1",
      "CIS Microsoft Windows Server Benchmark v3.0.0 - Section 18.3.1"
    ]
  },
  "SMB signing": {
    "severity": "HIGH",
    "description": "La signature SMB protège contre les attaques de type Man-in-the-Middle et relay.",
    "remediation": "Activer la signature SMB obligatoire côté serveur et client.",
    "commands": [
      "Set-ItemProperty -Path 'HKLM:\\System\\CurrentControlSet\\Services\\LanmanServer\\Parameters' -Name 'requiresecuritysignature' -Value 1",
      "Set-ItemProperty -Path 'HKLM:\\System\\CurrentControlSet\\Services\\LanmanWorkstation\\Parameters' -Name 'requiresecuritysignature' -Value 1"
    ],
    "references": [
      "CIS Microsoft Windows Server Benchmark v3.0.0 - Section 2.3.8.3 et 2.3.9.2"
    ]
  },
  "RDP SecurityLayer": {
    "severity": "HIGH",
    "description": "La couche de sécurité RDP doit utiliser TLS pour chiffrer les communications.",
    "remediation": "Configurer RDP pour utiliser la couche de sécurité TLS (valeur 2).",
    "commands": [
      "Set-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp' -Name 'SecurityLayer' -Value 2"
    ],
    "references": [
      "CIS Microsoft Windows Server Benchmark v3.0.0 - Section 18.9.60.3.9.1"
    ]
  },
  "RDP NLA": {
    "severity": "HIGH",
    "description": "L'authentification au niveau du réseau (NLA) force l'authentification avant l'établissement de la session RDP.",
    "remediation": "Activer NLA pour toutes les connexions RDP.",
    "commands": [
      "Set-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp' -Name 'UserAuthentication' -Value 1"
    ],
    "references": [
      "CIS Microsoft Windows Server Benchmark v3.0.0 - Section 18.9.60.3.9.2"
    ]
  },
  "LLMNR": {
    "severity": "MEDIUM",
    "description": "Afin de se protéger de certaines attaques par Man-In-The-Middle, les protocoles de résolution de noms NBT-NS et LLMNR doivent être désactivés.",
    "remediation": "LLMNR : la clé SOFTWARE\\Policies\\Microsoft\\Windows NT\\DNSClient\\EnableMulticast doit être présente et définie à 0",
    "commands": [
      "New-Item -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\DNSClient' -Force",
      "Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\DNSClient' -Name 'EnableMulticast' -Value 0"
    ],
    "references": [
      "CIS Microsoft Windows Server Benchmark v3.0.0 - Section 18.5.11.2"
    ]
  },
  "BIOS/UEFI Password": {
    "severity": "HIGH",
    "description": "Recommandation pour le mot de passe BIOS (pas de check possible mais message à afficher).",
    "remediation": "Configurer un mot de passe BIOS/UEFI dans les paramètres du firmware pour empêcher les modifications non autorisées.",
    "commands": [
      "# Action manuelle requise : Redémarrer et accéder au BIOS/UEFI pour définir un mot de passe"
    ],
    "references": [
      "ANSSI - Recommandations de sécurité matérielle"
    ]
  },
  "Firewall profile": {
    "severity": "HIGH",
    "description": "Le pare-feu Windows doit être activé sur tous les profils réseau.",
    "remediation": "Activer le pare-feu Windows pour les profils Domain, Private et Public.",
    "commands": [
      "Set-NetFirewallProfile -Profile Domain,Public,Private -Enabled True"
    ],
    "references": [
      "CIS Microsoft Windows Server Benchmark v3.0.0 - Section 9.1, 9.2, 9.3"
    ]
  },
  "Service check": {
    "severity": "MEDIUM",
    "description": "Certains services peuvent présenter des risques de sécurité s'ils sont actifs sans nécessité.",
    "remediation": "Désactiver les services non nécessaires (Print Spooler, WebClient, WinHttpAutoProxySvc).",
    "commands": [
      "Stop-Service -Name 'Spooler' -Force",
      "Set-Service -Name 'Spooler' -StartupType Disabled",
      "Stop-Service -Name 'WebClient' -Force",
      "Set-Service -Name 'WebClient' -StartupType Disabled"
    ],
    "references": [
      "Microsoft Security Baseline",
      "PrintNightmare vulnerability (CVE-2021-34527)"
    ]
  },
  "Audit logon/logoff": {
    "severity": "MEDIUM",
    "description": "L'audit des connexions permet de détecter les tentatives d'accès non autorisées.",
    "remediation": "Configurer l'audit des événements de connexion/déconnexion.",
    "commands": [
      "auditpol /set /category:'Logon/Logoff' /success:enable /failure:enable"
    ],
    "references": [
      "CIS Microsoft Windows Server Benchmark v3.0.0 - Section 17.5"
    ]
  },
  "Security log size": {
    "severity": "LOW",
    "description": "Un journal de sécurité trop petit peut perdre des événements importants.",
    "remediation": "Augmenter la taille maximale du journal de sécurité à au moins 1 GB.",
    "commands": [
      "wevtutil sl Security /ms:1073741824"
    ],
    "references": [
      "CIS Microsoft Windows Server Benchmark v3.0.0 - Section 17.1.1"
    ]
  },
  "Sysmon service": {
    "severity": "INFO",
    "description": "Sysmon fournit une journalisation détaillée des événements système pour la détection d'intrusion.",
    "remediation": "Installer Sysmon avec une configuration adaptée pour améliorer la détection des menaces.",
    "commands": [
      "# Télécharger Sysmon depuis Microsoft Sysinternals",
      "# Télécharger une configuration recommandée (ex: SwiftOnSecurity config)",
      "sysmon64.exe -accepteula -i sysmonconfig.xml"
    ],
    "references": [
      "Microsoft Sysinternals - Sysmon",
      "SwiftOnSecurity Sysmon Config"
    ]
  },
  "LSASS RunAsPPL": {
    "severity": "CRITICAL",
    "description": "LSASS (Local Security Authority Subsystem Service) s'exécute en mode normal. Sans protection RunAsPPL, les attaquants peuvent injecter du code dans LSASS pour extraire les credentials via Mimikatz.",
    "remediation": "Activer la protection LSASS en mode Protected Process Light (PPL) pour empêcher l'injection de code malveillant.",
    "commands": [
      "New-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa' -Name RunAsPPL -Value 1 -PropertyType DWORD -Force",
      "# Redémarrage requis"
    ],
    "references": [
      "Microsoft Defender Research - LSASS Protection",
      "CIS Microsoft Windows Server Benchmark - Section 2.3.11.9",
      "ANSSI - Durcissement des configurations Windows"
    ]
  },
  "WDigest (Cleartext Passwords)": {
    "severity": "HIGH",
    "description": "WDigest peut stocker les mots de passe en clair en mémoire. Cela permet aux attaquants d'extraire les credentials via des outils comme Mimikatz après une compromission.",
    "remediation": "Désactiver WDigest pour empêcher le stockage des mots de passe en clair en mémoire.",
    "commands": [
      "Set-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest' -Name UseLogonCredential -Value 0"
    ],
    "references": [
      "Microsoft Security Advisory - WDigest Authentication",
      "CIS Microsoft Windows Server Benchmark - Section 2.3.11.8",
      "ANSSI - Recommandations de sécurité"
    ]
  },
  "NetBIOS (NoNameReleaseOnDemand)": {
    "severity": "MEDIUM",
    "description": "Afin de se protéger de certaines attaques par Man-In-The-Middle, les protocoles de résolution de noms NBT-NS et LLMNR doivent être désactivés.",
    "remediation": "NETBIOS : la clé System\\CurrentControlSet\\Services\\Netbt\\Parameters\\NoNameReleaseOnDemand doit être définie à 1",
    "commands": [
      "Set-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Services\\NetBT\\Parameters' -Name NoNameReleaseOnDemand -Value 1"
    ],
    "references": [
      "Microsoft Technet - NetBIOS Configuration",
      "CIS Microsoft Windows Server Benchmark - Section 2.3.10.2",
      "ANSSI - Protection contre les attaques de chaîne latérale"
    ]
  },
  "Defender RealTime Protection": {
    "severity": "CRITICAL",
    "description": "La protection en temps réel de Windows Defender est désactivée. Cela expose le système aux malwares et ransomwares sans détection à l'exécution.",
    "remediation": "Activer la protection en temps réel de Windows Defender pour une détection immédiate des menaces.",
    "commands": [
      "Set-MpPreference -DisableRealtimeMonitoring $false"
    ],
    "references": [
      "Microsoft Defender Documentation",
      "CIS Microsoft Windows Server Benchmark - Section 17.1",
      "ANSSI - Recommandations antivirus"
    ]
  },
  "AppLocker Rules": {
    "severity": "HIGH",
    "description": "AppLocker n'est pas configuré. Sans AppLocker, tous les exécutables peuvent s'exécuter sans contrôle, facilitant l'exécution de malwares et scripts malveillants.",
    "remediation": "Définir des règles AppLocker pour whitelist les exécutables, DLL, scripts et MSI autorisés. Commencer par un mode audit puis passer en mode enforcement.",
    "commands": [
      "# Mode audit (recommandé pour commencer)",
      "Set-AppLockerPolicy -XmlPolicy C:\\AppLocker\\audit.xml -Action Audit",
      "# Mode enforcement (après validation)",
      "Set-AppLockerPolicy -XmlPolicy C:\\AppLocker\\enforcement.xml -Action Enforce"
    ],
    "references": [
      "Microsoft AppLocker Documentation",
      "CIS Microsoft Windows Server Benchmark - Section 9.1.1",
      "ANSSI - Contrôle des exécutables"
    ]
  },
  "Cached Logons Count": {
    "severity": "MEDIUM",
    "description": "Un nombre élevé de sessions en cache permet aux attaquants d'extraire les hashes MSCache2 en cas de compromission offline. Ces hashes peuvent être attaqués par brute-force.",
    "remediation": "Réduire le nombre de sessions en cache à 0-2 (1 recommandé) pour limiter l'exposition en cas de vol de base de données SAM.",
    "commands": [
      "Set-ItemProperty -Path 'HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon' -Name CachedLogonsCount -Value 1"
    ],
    "references": [
      "Microsoft Technet - CachedLogonsCount",
      "CIS Microsoft Windows Server Benchmark - Section 2.3.6.4",
      "ANSSI - Protection contre les mouvements latéraux"
    ]
  },
  "WinRM Hardening": {
    "severity": "HIGH",
    "description": "L'authentification Basic de WinRM et le trafic non chiffré permettent les attaques Man-In-The-Middle et le vol de credentials lors de l'administration à distance.",
    "remediation": "Désactiver l'authentification Basic et forcer le chiffrement pour WinRM en utilisant Kerberos ou certificats.",
    "commands": [
      "Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\WinRM\\Service' -Name AllowBasic -Value 0",
      "Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\WinRM\\Service' -Name AllowUnencryptedTraffic -Value 0"
    ],
    "references": [
      "Microsoft WinRM Security Configuration",
      "CIS Microsoft Windows Server Benchmark - Section 2.3.11.7",
      "ANSSI - Sécurisation de l'administration à distance"
    ]
  },
  "RDP Encryption Level": {
    "severity": "MEDIUM",
    "description": "Un faible niveau de chiffrement RDP (niveau 1-2) expose les sessions RDP à des attaques de décodage et d'interception de trafic.",
    "remediation": "Configurer le niveau de chiffrement RDP minimum à 3 (High) ou 4 (FIPS) pour protéger les données transmises.",
    "commands": [
      "Set-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp' -Name MinEncryptionLevel -Value 3",
      "# Pour FIPS (valeur 4):",
      "Set-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp' -Name MinEncryptionLevel -Value 4"
    ],
    "references": [
      "Microsoft RDP Security Configuration",
      "CIS Microsoft Windows Server Benchmark - Section 2.3.2.2",
      "NIST SP 800-53 - IA-3: Device Identification and Authentication"
    ]
  },
  "ASR Rules (Exploit Guard)": {
    "severity": "MEDIUM",
    "description": "Les règles Attack Surface Reduction (ASR) ne sont pas configurées. Cela laisse la machine vulnérable aux techniques d'exploitation courantes utilisées par les malwares et les attaquants.",
    "remediation": "Activer les règles ASR via GPO ou PowerShell pour bloquer les comportements d'exploitation (injection de code, Office exploits, etc.).",
    "commands": [
      "# Lister les règles ASR disponibles",
      "Get-MpPreference | Select-Object -ExpandProperty AttackSurfaceReductionRules_Ids",
      "# Exemple: Bloquer les scripts Office",
      "Set-MpPreference -AttackSurfaceReductionRules_Actions Enabled"
    ],
    "references": [
      "Microsoft Attack Surface Reduction Documentation",
      "CIS Microsoft Windows Server Benchmark - Section 17.2",
      "ANSSI - Protection contre les exploits"
    ]
  },
  "Controlled Folder Access": {
    "severity": "MEDIUM",
    "description": "La protection des dossiers contrôlés est désactivée. Cela expose le système aux attaques ransomware qui peuvent chiffrer ou supprimer les données critiques.",
    "remediation": "Activer la protection des dossiers contrôlés pour empêcher les modifications non autorisées des documents sensibles.",
    "commands": [
      "Set-MpPreference -EnableControlledFolderAccess Enabled",
      "# Ajouter des dossiers protégés supplémentaires si nécessaire",
      "Add-MpPreference -ControlledFolderAccessProtectedFolders 'C:\\Users\\<user>\\Documents'"
    ],
    "references": [
      "Microsoft Controlled Folder Access Documentation",
      "CIS Microsoft Windows Server Benchmark - Section 17.3",
      "ANSSI - Protection contre les ransomwares"
    ]
  },
  "USB AutoRun": {
    "severity": "MEDIUM",
    "description": "L'exécution automatique (AutoRun) des périphériques USB est activée. Cela permet aux attaquants de lancer des malwares automatiquement via une clé USB malveillante (attaque de gain d'accès initial).",
    "remediation": "Désactiver complètement l'exécution automatique pour tous les types de lecteurs (disquettes, lecteurs optiques, USB, disques amovibles).",
    "commands": [
      "Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer' -Name NoDriveTypeAutoRun -Value 255"
    ],
    "references": [
      "Microsoft AutoRun Security Advisory",
      "CIS Microsoft Windows Server Benchmark - Section 2.3.7.5",
      "ANSSI - Contrôle des périphériques amovibles"
    ]
  },
  "BitLocker C:": {
    "severity": "HIGH",
    "description": "BitLocker n'est pas activé sur le disque système. Cela expose les données au repos et à la compromission du disque en cas de vol physique ou d'accès non autorisé.",
    "remediation": "Activer BitLocker sur le disque système avec une clé de récupération stockée de manière sécurisée (Active Directory ou compte Microsoft).",
    "commands": [
      "# Vérifier si TPM est disponible",
      "Get-Tpm",
      "# Activer BitLocker",
      "Enable-BitLocker -MountPoint 'C:' -EncryptionMethod Aes256 -TpmProtector",
      "# Sauvegarder la clé de récupération",
      "$(Get-BitLockerVolume -MountPoint 'C:').KeyProtector | select-object -ExpandProperty 'RecoveryPassword'"
    ],
    "references": [
      "Microsoft BitLocker Documentation",
      "CIS Microsoft Windows Server Benchmark - Section 2.3.7",
      "ANSSI - Chiffrement des données au repos"
    ]
  },
  "PowerShell Language Mode": {
    "severity": "LOW",
    "description": "PowerShell s'exécute en mode FullLanguage. Cela permet l'exécution de scripts PowerShell complexes et potentiellement malveillants sans restriction.",
    "remediation": "Envisager le déploiement du mode ConstrainedLanguage pour les utilisateurs standards via AppLocker ou Windows Defender Application Control (WDAC) pour réduire les risques de scripts malveillants.",
    "commands": [
      "# Mode ConstrainedLanguage ne peut pas être modifié directement",
      "# Il doit être configuré via AppLocker ou WDAC à l'aide de GPO:",
      "# 1. Créer une politique AppLocker qui interdit l'exécution de PowerShell en FullLanguage",
      "# 2. Ou utiliser WDAC pour définir des règles de contrôle d'exécution"
    ],
    "references": [
      "Microsoft PowerShell ConstrainedLanguage Mode",
      "CIS Microsoft Windows Server Benchmark - Section 9.2",
      "ANSSI - Contrôle des scripts"
    ]
  },
  "SMB Client Signing": {
    "severity": "HIGH",
    "description": "La signature SMB côté client n'est pas requise. Cela permet aux attaquants d'utiliser la machine comme relais dans les attaques NTLM Relay, capturant ou rejouant les credentials.",
    "remediation": "Forcer la signature SMB côté client (LanmanWorkstation) pour garantir l'intégrité et l'authenticité de chaque échange SMB.",
    "commands": [
      "Set-ItemProperty -Path 'HKLM:\\System\\CurrentControlSet\\Services\\LanmanWorkstation\\Parameters' -Name RequireSecuritySignature -Value 1"
    ],
    "references": [
      "Microsoft SMB Signing Configuration",
      "CIS Microsoft Windows Server Benchmark - Section 2.3.11.3",
      "ANSSI - Protection contre les attaques NTLM Relay"
    ]
  }
}
