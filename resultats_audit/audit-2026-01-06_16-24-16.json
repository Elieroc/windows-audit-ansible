[
  {
    "host": "ESGI5-server",
    "tasks": [
      {
        "task": "Administrator account",
        "msg": "enabled",
        "audit_status": "FAIL",
        "severity": "HIGH",
        "mitigation_advice": "Il est recommandé de désactiver le compte Administrateur par défaut et d'utiliser des comptes nominatifs avec droits maîtrisés (LAPS pour les mots de passe locaux).",
        "mitigation_cmd": "Disable-LocalUser -Name 'Administrator'"
      },
      {
        "task": "Guest account",
        "msg": "disabled",
        "audit_status": "PASS",
        "severity": "HIGH",
        "mitigation_advice": "Il est recommandé de désactiver le compte Guest par défaut si non utilisé.",
        "mitigation_cmd": "Disable-LocalUser -Name 'Guest'"
      },
      {
        "task": "Password minimum length",
        "msg": "FAIL (<12)",
        "audit_status": "FAIL",
        "severity": "HIGH",
        "mitigation_advice": "Augmentez la longueur minimale des mots de passe (recommandation: 12+ pour utilisateurs, 15+ pour comptes privilégiés).",
        "mitigation_cmd": "net accounts /minpwlen:12"
      },
      {
        "task": "LAPS installation",
        "msg": "not installed",
        "audit_status": "FAIL",
        "severity": "HIGH",
        "mitigation_advice": "Installer et déployer Microsoft LAPS pour gérer automatiquement les mots de passe des comptes administrateurs locaux.",
        "mitigation_cmd": "Install-Module -Name LAPS -Force"
      },
      {
        "task": "UAC (EnableLUA)",
        "msg": "enabled",
        "audit_status": "PASS",
        "severity": "HIGH",
        "mitigation_advice": "Activer l'UAC pour réduire la surface d'exécution avec privilèges élevés.",
        "mitigation_cmd": "Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System' -Name EnableLUA -Value 1"
      },
      {
        "task": "SMBv1",
        "msg": "disabled",
        "audit_status": "PASS",
        "severity": "CRITICAL",
        "mitigation_advice": "Désactiver SMBv1, obsolète et vulnérable.",
        "mitigation_cmd": "Disable-WindowsOptionalFeature -Online -FeatureName SMB1Protocol -NoRestart"
      },
      {
        "task": "SMB signing",
        "msg": "not required",
        "audit_status": "FAIL",
        "severity": "HIGH",
        "mitigation_advice": "Forcer la signature SMB côté serveur pour se protéger contre le relay NTLM.",
        "mitigation_cmd": "Set-ItemProperty -Path 'HKLM:\\System\\CurrentControlSet\\Services\\LanmanServer\\Parameters' -Name requiresecuritysignature -Value 1"
      },
      {
        "task": "RDP SecurityLayer",
        "msg": "TLS (2)",
        "audit_status": "PASS",
        "severity": "HIGH",
        "mitigation_advice": "Configurer SecurityLayer à 2 pour forcer TLS pour RDP.",
        "mitigation_cmd": "Set-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp' -Name SecurityLayer -Value 2"
      },
      {
        "task": "RDP NLA",
        "msg": "enabled",
        "audit_status": "PASS",
        "severity": "HIGH",
        "mitigation_advice": "Activer NLA pour protéger le service RDP.",
        "mitigation_cmd": "Set-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp' -Name UserAuthentication -Value 1"
      },
      {
        "task": "Record dangerous services",
        "msg": "All items completed"
      },
      {
        "task": "Record firewall profiles",
        "msg": "All items completed"
      },
      {
        "task": "LLMNR",
        "msg": "enabled",
        "audit_status": "FAIL",
        "severity": "MEDIUM",
        "mitigation_advice": "Afin de se protéger de certaines attaques par Man-In-The-Middle, les protocoles de résolution de noms NBT-NS et LLMNR doivent être désactivés. LLMNR : la clé SOFTWARE\\Policies\\Microsoft\\Windows NT\\DNSClient\\EnableMulticast doit être présente et définie à 0",
        "mitigation_cmd": "Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\DNSClient' -Name EnableMulticast -Value 0"
      },
      {
        "task": "Audit logon/logoff",
        "msg": "configured",
        "audit_status": "PASS",
        "severity": "MEDIUM",
        "mitigation_advice": "Configurer l'audit pour succès et échecs sur logon/logoff via GPO.",
        "mitigation_cmd": "auditpol /set /category:'Logon/Logoff' /success:enable /failure:enable"
      },
      {
        "task": "Security log size",
        "msg": "<1GB",
        "audit_status": "WARNING",
        "severity": "LOW",
        "mitigation_advice": "Augmenter la taille du journal de sécurité pour éviter la perte d'événements.",
        "mitigation_cmd": "wevtutil sl Security /ms:1073741824"
      },
      {
        "task": "Sysmon service",
        "msg": "not installed",
        "audit_status": "INFO",
        "severity": "INFO",
        "mitigation_advice": "Installer Sysmon pour une meilleure journalisation si nécessaire.",
        "mitigation_cmd": "sysmon64.exe -accepteula -i sysmonconfig.xml"
      },
      {
        "task": "LSASS RunAsPPL",
        "msg": "disabled",
        "audit_status": "FAIL",
        "severity": "CRITICAL",
        "mitigation_advice": "Activer la protection LSA pour empêcher l'injection de code (Mimikatz). RunAsPPL force LSASS à s'exécuter en mode Protected Process Light.",
        "mitigation_cmd": "New-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa' -Name RunAsPPL -Value 1 -PropertyType DWORD -Force"
      },
      {
        "task": "WDigest (Cleartext Passwords)",
        "msg": "enabled/default",
        "audit_status": "FAIL",
        "severity": "HIGH",
        "mitigation_advice": "Désactiver WDigest pour éviter le stockage de mots de passe en clair en mémoire (attaques post-exploitation).",
        "mitigation_cmd": "Set-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest' -Name UseLogonCredential -Value 0"
      },
      {
        "task": "NetBIOS (NoNameReleaseOnDemand)",
        "msg": "default",
        "audit_status": "FAIL",
        "severity": "MEDIUM",
        "mitigation_advice": "Afin de se protéger de certaines attaques par Man-In-The-Middle, les protocoles de résolution de noms NBT-NS et LLMNR doivent être désactivés. NETBIOS : la clé System\\CurrentControlSet\\Services\\Netbt\\Parameters\\NoNameReleaseOnDemand doit être définie à 1",
        "mitigation_cmd": "Set-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Services\\NetBT\\Parameters' -Name NoNameReleaseOnDemand -Value 1"
      },
      {
        "task": "Defender RealTime Protection",
        "msg": "enabled",
        "audit_status": "PASS",
        "severity": "CRITICAL",
        "mitigation_advice": "Activer la protection en temps réel de Windows Defender pour détecter les malwares à l'exécution.",
        "mitigation_cmd": "Set-MpPreference -DisableRealtimeMonitoring $false"
      },
      {
        "task": "AppLocker Rules",
        "msg": "No rules enforced",
        "audit_status": "WARNING",
        "severity": "HIGH",
        "mitigation_advice": "Définir des règles AppLocker pour contrôler l'exécution des binaires et scripts (whitelist par défaut).",
        "mitigation_cmd": "New-AppLockerPolicy -RuleType Exe,Msi,Script,Dll -User Everyone -RuleNamePrefix 'Default' -Force"
      },
      {
        "task": "Cached Logons Count",
        "msg": "10",
        "audit_status": "FAIL",
        "severity": "MEDIUM",
        "mitigation_advice": "Réduire le nombre de sessions en cache (0-2) pour limiter l'extraction de hash MSCache2 par les attaquants en cas de compromission offline.",
        "mitigation_cmd": "Set-ItemProperty -Path 'HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon' -Name CachedLogonsCount -Value 1"
      },
      {
        "task": "WinRM Hardening",
        "msg": "Insecure",
        "audit_status": "FAIL",
        "severity": "HIGH",
        "mitigation_advice": "Désactiver l'authentification Basic et le trafic non chiffré pour WinRM pour éviter les attaques Man-In-The-Middle.",
        "mitigation_cmd": "Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\WinRM\\Service' -Name AllowBasic -Value 0; Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\WinRM\\Service' -Name AllowUnencryptedTraffic -Value 0"
      },
      {
        "task": "RDP Encryption Level",
        "msg": "Low",
        "audit_status": "WARNING",
        "severity": "MEDIUM",
        "mitigation_advice": "Régler le niveau de chiffrement RDP à 3 (High) ou 4 (FIPS) pour protéger les sessions RDP.",
        "mitigation_cmd": "Set-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp' -Name MinEncryptionLevel -Value 3"
      },
      {
        "task": "ASR Rules (Exploit Guard)",
        "msg": "Not Configured",
        "audit_status": "WARNING",
        "severity": "MEDIUM",
        "mitigation_advice": "Activer les règles de réduction de surface d'attaque (ASR) via GPO ou PowerShell pour bloquer les techniques d'exploitation courantes.",
        "mitigation_cmd": "Set-MpPreference -AttackSurfaceReductionRules_Actions Enabled"
      },
      {
        "task": "Controlled Folder Access",
        "msg": "Disabled",
        "audit_status": "INFO",
        "severity": "MEDIUM",
        "mitigation_advice": "Activer la protection des dossiers contrôlés pour bloquer les attaques ransomware et les modifications non autorisées.",
        "mitigation_cmd": "Set-MpPreference -EnableControlledFolderAccess Enabled"
      },
      {
        "task": "USB AutoRun",
        "msg": "Insecure",
        "audit_status": "FAIL",
        "severity": "MEDIUM",
        "mitigation_advice": "Désactiver l'exécution automatique pour tous les lecteurs pour prévenir les attaques par USB malveillants.",
        "mitigation_cmd": "Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer' -Name NoDriveTypeAutoRun -Value 255"
      },
      {
        "task": "BitLocker C:",
        "msg": "Off/Not installed",
        "audit_status": "FAIL",
        "severity": "HIGH",
        "mitigation_advice": "Activer BitLocker sur le disque système pour chiffrer les données au repos et protéger contre le vol de données physiques.",
        "mitigation_cmd": "Enable-BitLocker -MountPoint 'C:' -EncryptionMethod Aes256"
      },
      {
        "task": "PowerShell Language Mode",
        "msg": "FullLanguage",
        "audit_status": "INFO",
        "severity": "LOW",
        "mitigation_advice": "Envisager le mode ConstrainedLanguage pour les utilisateurs standards via AppLocker ou WDAC pour bloquer les scripts malveillants avancés.",
        "mitigation_cmd": "# Configuration via AppLocker ou WDAC - ne peut pas être changé directement"
      },
      {
        "task": "SMB Client Signing",
        "msg": "Not Required",
        "audit_status": "FAIL",
        "severity": "HIGH",
        "mitigation_advice": "Forcer la signature SMB côté client (LanmanWorkstation) pour empêcher que la machine ne serve de relais dans les attaques de replay/relay NTLM.",
        "mitigation_cmd": "Set-ItemProperty -Path 'HKLM:\\System\\CurrentControlSet\\Services\\LanmanWorkstation\\Parameters' -Name RequireSecuritySignature -Value 1"
      },
      {
        "task": "PowerShell Script Block Logging",
        "msg": "Disabled",
        "audit_status": "FAIL",
        "severity": "HIGH",
        "mitigation_advice": "Activer la journalisation des blocs de scripts PowerShell pour auditer les commandes exécutées, même offusquées.",
        "mitigation_cmd": "New-Item -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging' -Force; Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging' -Name EnableScriptBlockLogging -Value 1"
      },
      {
        "task": "WSUS Configuration",
        "msg": "Direct Microsoft Update",
        "audit_status": "PASS",
        "severity": "HIGH",
        "mitigation_advice": "Si un serveur WSUS est utilisé, il DOIT être configuré en HTTPS pour éviter l'injection de fausses mises à jour.",
        "mitigation_cmd": "Configurer le serveur WSUS pour utiliser SSL/TLS et mettre à jour la GPO."
      },
      {
        "task": "Virtualization Based Security (Credential Guard)",
        "msg": "Not Running",
        "audit_status": "INFO",
        "severity": "MEDIUM",
        "mitigation_advice": "Activer VBS et Credential Guard si le matériel le supporte (nécessite CPU avec virtualisation + TPM).",
        "mitigation_cmd": "Activer via GPO: Configuration Ordinateur > Système > Device Guard > Activer la sécurité basée sur la virtualisation."
      },
      {
        "task": "Local Admin Group Members",
        "msg": "WIN-RNGUKIGIR06\\Administrator\r\nWIN-RNGUKIGIR06\\michel\r\n",
        "audit_status": "PASS",
        "severity": "MEDIUM",
        "mitigation_advice": "Auditer régulièrement les membres du groupe Administrateurs et supprimer les comptes inutilisés. Utiliser LAPS pour gérer les comptes locaux.",
        "mitigation_cmd": "Get-LocalGroupMember -Group 'Administrateurs'"
      },
      {
        "task": "IPv6 Status",
        "msg": "Enabled (Default)",
        "audit_status": "INFO",
        "severity": "LOW",
        "mitigation_advice": "Si IPv6 n'est pas utilisé, le désactiver via la clé DisabledComponents (valeur 0xFF/255) pour réduire la surface d'attaque.",
        "mitigation_cmd": "Set-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Services\\Tcpip6\\Parameters' -Name DisabledComponents -Value 255"
      },
      {
        "task": "Windows Event Forwarding (WEF)",
        "msg": "Not Configured",
        "audit_status": "FAIL",
        "severity": "MEDIUM",
        "mitigation_advice": "Configurer WEF pour centraliser les journaux sur un serveur de logs centralisé (SIEM). Cela permet une meilleure détection d'incidents et conformité.",
        "mitigation_cmd": "# Configuration via GPO ou WEF Subscription Manager"
      },
      {
        "task": "Installed Software Inventory",
        "msg": "Oracle VirtualBox Guest Additions 7.1.6 (v7.1.6.167084)\r\n",
        "audit_status": "INFO",
        "severity": "MEDIUM",
        "mitigation_advice": "Audit complet de tous les logiciels installés. Vérifier les versions des logiciels critiques (Java, Adobe, navigateurs, etc.). Maintenir à jour et appliquer les patches rapidement, particulièrement pour les logiciels côté client souvent exploités.",
        "mitigation_cmd": "# Mettre à jour via Windows Update, WSUS ou les outils spécifiques des éditeurs"
      },
      {
        "task": "Service Registry Permissions",
        "msg": "BITS:Secure\r\nSpooler:Secure\r\nUpdateOrchestrator:Error/NotFound\r\nWinRM:Secure\r\nlsass:Error/NotFound\r\n",
        "audit_status": "PASS",
        "severity": "HIGH",
        "mitigation_advice": "Les services critiques ne doivent être modifiables que par SYSTEM et Administrateurs. Supprimer les droits Write/Modify pour le groupe Users ou Utilisateurs authentifiés sur les clés de registre des services.",
        "mitigation_cmd": "# Utiliser icacls ou Set-Acl pour corriger les permissions. Exemple: icacls 'HKLM\\SYSTEM\\CurrentControlSet\\Services\\Spooler' /grant:r 'SYSTEM:(F)' /grant:r 'Admins:(F)' /remove 'Users'"
      },
      {
        "task": "LMHASH Disable (NoLMHash)",
        "msg": "NoLMHash=0:Vulnerable",
        "audit_status": "FAIL",
        "severity": "HIGH",
        "mitigation_advice": "Activer NoLMHash pour empêcher le stockage des empreintes LM dans la base SAM. Les hashes LM sont vulnérables aux attaques par force brute. La valeur 'aad3b435b51404eeaad3b435b51404ee' indique un mot de passe vide ou l'absence de stockage LM.",
        "mitigation_cmd": "secedit /export /cfg C:\\secpol.txt; (Get-Content C:\\secpol.txt) -replace 'NoLMHash = 0', 'NoLMHash = 1' | Set-Content C:\\secpol.txt; secedit /configure /db C:\\Windows\\security\\local.sdb /cfg C:\\secpol.txt /overwrite /quiet"
      },
      {
        "task": "Smart App Control",
        "msg": "NotPresent:Not Installed/Not Compatible",
        "audit_status": "INFO",
        "severity": "MEDIUM",
        "mitigation_advice": "Smart App Control protège le système en contrôlant l'exécution des applications. Disponible sur Windows 11 (version 22572+) avec une installation propre en Amérique du Nord ou Europe. 0=Désactivé, 1=Activé, 2=Mode évaluation.",
        "mitigation_cmd": "Smart App Control ne peut être activé que lors d'une installation Windows propre. Accédez à Paramètres > Confidentialité et sécurité > App Security Management"
      },
      {
        "task": "BIOS/UEFI Password",
        "msg": "Manual verification required",
        "audit_status": "INFO",
        "severity": "HIGH",
        "mitigation_advice": "Recommandation pour le mot de passe BIOS (pas de check possible mais message à afficher).",
        "mitigation_cmd": "Configurer un mot de passe BIOS/UEFI dans les paramètres du firmware"
      },
      {
        "task": "Windows Update Level",
        "msg": "Windows-Older:Build",
        "audit_status": "PASS",
        "severity": "CRITICAL",
        "mitigation_advice": "Maintenir le système à jour avec les derniers patches de sécurité est essentiel. Windows 11 Build 22621+ est considéré comme à jour. Windows 10 a atteint la fin du support (EOS: 14 octobre 2025). Les versions antérieures ne reçoivent plus de mises à jour de sécurité et présentent un risque critique. Appliquez immédiatement tous les patchs disponibles via Windows Update.",
        "mitigation_cmd": "Aller à Paramètres > Mise à jour et sécurité > Mises à jour Windows > Vérifier les mises à jour. Ou utiliser: Install-Module -Name PSWindowsUpdate -Force; Get-WindowsUpdate -Install -AcceptAll"
      },
      {
        "task": "Windows Hello for Business",
        "msg": "Disabled:NotConfigured",
        "audit_status": "FAIL",
        "severity": "HIGH",
        "mitigation_advice": "Windows Hello for Business offre une authentification multi-facteur (MFA) basée sur la biométrie ou le PIN, renforçant considérablement la sécurité des accès. L'activation peut se faire via GPO (HKLM:\\SOFTWARE\\Policies\\Microsoft\\PassportForWork\\Enabled) ou CSP (HKLM:\\SOFTWARE\\Microsoft\\Policies\\PassportForWork\\UsePassportForWork). Cela remplace les mots de passe traditionnels par une authentification multi-facteurs.",
        "mitigation_cmd": "Configurer via GPO: Configuration Ordinateur > Politiques > Modèles d'administration > Système > Ouverture de session > Configurer Windows Hello for Business. Ou via CSP/Intune: Policies/Windows/PassportForWork"
      },
      {
        "task": "Just Enough Administration (JEA)",
        "msg": "NotConfigured:NoJEA",
        "audit_status": "PASS",
        "severity": "MEDIUM",
        "mitigation_advice": "Just Enough Administration (JEA) limite les privilèges des comptes de service et administrateurs en ne loro accordant que les cmdlets PowerShell strictement nécessaires. Cela réduit les risques de compromission et de mouvements latéraux. Les rôles JEA doivent définir: RoleDefinitions, VisibleCmdlets, et ScriptBlockLogging pour auditer les actions.",
        "mitigation_cmd": "Configurer un endpoint JEA: New-PSRoleCapabilityFile -Path 'C:\\Program Files\\WindowsPowerShell\\Modules\\JEA\\RoleCapabilities\\LimitedRole.psrc' ; New-PSSessionConfigurationFile -RunAsVirtualAccount -RoleDefinitions @{LimitedRole='@{RoleCapabilityFiles=\"C:\\Program Files\\WindowsPowerShell\\Modules\\JEA\\RoleCapabilities\\LimitedRole.psrc\"}'}"
      },
      {
        "task": "SMB Share vs NTFS Permissions",
        "msg": "No shares to audit",
        "audit_status": "PASS",
        "severity": "HIGH",
        "mitigation_advice": "Les permissions SMB et NTFS doivent être alignées. Les droits SMB ne sont restrictifs que s'ils sont plus permissifs que les droits NTFS. Une bonne pratique est: droits SMB restrictifs (Everyone: Read) + droits NTFS granulaires. Auditer régulièrement l'alignement pour éviter les escalades de privilèges.",
        "mitigation_cmd": "Vérifier: Get-SmbShare | foreach {Get-SmbShareAccess -Name $_.Name} et comparer avec: Get-Acl 'C:\\path\\to\\share' | Select-Object -ExpandProperty Access. Corriger en harmonisant les droits via Grant-SmbShareAccess et Set-Acl."
      },
      {
        "task": "Startup Services Inventory",
        "msg": "StartupServices:Count=51\r\n- BFE\r\n- BrokerInfrastructure\r\n- CDPSvc\r\n- CDPUserSvc_44dbd\r\n- CoreMessagingRegistrar\r\n- CryptSvc\r\n- DcomLaunch\r\n- Dhcp\r\n- DiagTrack\r\n- Dnscache\r\n- DPS\r\n- EventLog\r\n- EventSystem\r\n- FontCache\r\n- gpsvc\r\n- iphlpsvc\r\n- LanmanServer\r\n- LanmanWorkstation\r\n- LSM\r\n- MDCoreSvc\r\n- mpssvc\r\n- MSDTC\r\n- NlaSvc\r\n- nsi\r\n- Power\r\n- ProfSvc\r\n- RemoteRegistry\r\n- RpcEptMapper\r\n- RpcSs\r\n- SamSs\r\n- Schedule\r\n- SENS\r\n- ShellHWDetection\r\n- Spooler\r\n- sppsvc\r\n- SysMain\r\n- SystemEventsBroker\r\n- Themes\r\n- TrkWks\r\n- UALSVC\r\n- UserManager\r\n- UsoSvc\r\n- VBoxService\r\n- W32Time\r\n- Wcmsvc\r\n- WebClient\r\n- WinDefend\r\n- Winmgmt\r\n- WinRM\r\n- WpnService\r\n- WpnUserService_44dbd\r\n",
        "audit_status": "INFO",
        "severity": "MEDIUM",
        "mitigation_advice": "Auditer les services lancés au démarrage est crucial pour identifier les entrées de persistance malveillante ou les services inutiles qui ralentissent le système. Désactiver les services non essentiels (DiagTrack, Spooler, etc.) et vérifier que les services Automatic n'ont pas été compromis. Chercher les services suspects ou les chemins d'exécution non standards.",
        "mitigation_cmd": "Lister via: Get-Service | Where-Object {$_.StartType -eq 'Automatic'} | Select-Object Name, DisplayName. Ou via WMIC: wmic startup get name,command. Désactiver un service: Set-Service -Name 'ServiceName' -StartupType Disabled"
      },
      {
        "task": "Running Processes Inventory",
        "msg": "RunningProcesses:Count=100\r\nSuspiciousProcesses:33\r\n  cmd (PID:1268)\r\n  cmd (PID:2744)\r\n  ctfmon (PID:3916)\r\n  dllhost (PID:1156)\r\n  dllhost (PID:1788)\r\n  dllhost (PID:3144)\r\n  fontdrvhost (PID:796)\r\n  fontdrvhost (PID:804)\r\n  Idle (PID:0)\r\n  MpDefenderCoreService (PID:2528)\r\n  msdtc (PID:4072)\r\n  MsMpEng (PID:2568)\r\n  MusNotifyIcon (PID:1376)\r\n  NisSrv (PID:3408)\r\n  powershell (PID:736)\r\n  powershell (PID:2748)\r\n  Registry (PID:104)\r\n  RuntimeBroker (PID:4124)\r\n  RuntimeBroker (PID:4176)\r\n  RuntimeBroker (PID:4728)\r\n  SearchUI (PID:3212)\r\n  ServerManager (PID:3760)\r\n  ShellExperienceHost (PID:2852)\r\n  sihost (PID:2244)\r\n  smartscreen (PID:4780)\r\n  spoolsv (PID:2416)\r\n  taskhostw (PID:3708)\r\n  TiWorker (PID:3448)\r\n  TrustedInstaller (PID:4864)\r\n  wininit (PID:468)\r\n  winrshost (PID:1340)\r\n  WmiPrvSE (PID:4468)\r\n  WmiPrvSE (PID:4908)\r\n",
        "audit_status": "INFO",
        "severity": "MEDIUM",
        "mitigation_advice": "Auditer régulièrement les processus en cours d'exécution aide à détecter les malwares, les rootkits et les comportements suspects. Chercher les processus: avec des chemins non-standard, lancés par des comptes de faible privilège mais avec droits élevés, avec des noms similaires à des processus système (comme svcholt.exe au lieu de svchost.exe), ou lancés depuis des répertoires TEMP. Utiliser des outils comme Autoruns ou Process Monitor pour approfondir.",
        "mitigation_cmd": "Lister tous les processus: Get-Process. Avec détails utilisateur: Get-Process | Select-Object -Property Name, Id, @{Name='Owner';Expression={$_.UserName}}. Tuer un processus: Stop-Process -Id PID -Force. Rechercher les processus suspectes: Get-Process | Where-Object {$_.Path -like '*temp*' -or $_.Path -like '*downloads*'}"
      },
      {
        "task": "Antivirus / EDR Presence",
        "msg": "ProtectionPresent:Yes\r\n- WindowsDefender:Active(EngineVersion=1.1.25110.1)\r\n",
        "audit_status": "PASS",
        "severity": "CRITICAL",
        "mitigation_advice": "La présence d'un antivirus ou EDR est essentielle. Windows Defender doit être actif par défaut. Pour une protection optimale en entreprise, déployer une solution EDR (CrowdStrike, SentinelOne, Defender for Endpoint, etc). Vérifier que les signatures sont à jour et que la protection en temps réel est activée.",
        "mitigation_cmd": "Vérifier Defender: Get-ItemProperty 'HKLM:\\SOFTWARE\\Microsoft\\Windows Defender' | Select-Object DisableAntiSpyware. Activer: Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Microsoft\\Windows Defender' -Name DisableAntiSpyware -Value 0. Vérifier EDR: Get-CimInstance -Namespace 'root\\SecurityCenter2' -ClassName 'AntiVirusProduct'"
      },
      {
        "task": "Detailed Installed Software Inventory",
        "msg": "NoApplicationsDetected\r\n",
        "audit_status": "INFO",
        "severity": "INFO",
        "mitigation_advice": "Audit complet de toutes les applications installées avec versions, éditeurs et dates. Cet inventaire permet de détecter: les applications non autorisées, les versions vulnérables, les doublons, les applications orphelines. Mettre à jour régulièrement et supprimer les applications non essentielles ou obsolètes.",
        "mitigation_cmd": "Exporter l'inventaire: Get-ItemProperty 'HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*' | Select-Object DisplayName, DisplayVersion, Publisher | Export-Csv -Path C:\\apps.csv. Ou via JSON: ConvertTo-Json | Out-File C:\\apps.json"
      }
    ]
  }
]